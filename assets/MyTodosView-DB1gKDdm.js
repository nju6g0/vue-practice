import{a as p,I as Q,_ as R,r as y,d as _,o,c as m,b as h,e as g,u as L,y as W,w as v,f as C,t as U,C as X,n as Z,M as ee,E as te,x as oe,l as ne,h as ae,z as b,g as z,P as se,F as M,j as N,p as le,k as re}from"./index-DPcHszT_.js";import{g as ue,U as A,C as de}from"./users.service-Cdh67N8Q.js";import{T as k}from"./todo.service-CvQajZR0.js";var ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"border",theme:"outlined"};function K(t){for(var l=1;l<arguments.length;l++){var n=arguments[l]!=null?Object(arguments[l]):{},d=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(n).filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable}))),d.forEach(function(f){ce(t,f,n[f])})}return t}function ce(t,l,n){return l in t?Object.defineProperty(t,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[l]=n,t}var $=function(l,n){var d=K({},l,n.attrs);return p(Q,K({},d,{icon:ie}),null)};$.displayName="BorderOutlined";$.inheritAttrs=!1;const ve=["value"],pe={class:"deleteButton"},fe={__name:"ListItem",props:["todo","loading"],emits:["onToggle","onPressEnter","onDelete"],setup(t,{emit:l}){const n=t,d=l,f=y(!1),e=y(n.todo.content),I=()=>{d("onToggle",{id:n.todo.id,status:!n.todo.status})},u=()=>{f.value=!0},T=()=>{const x=e.value.trim();e.value.trim().length!==0&&n.todo.content!==x&&d("onPressEnter",{id:n.todo.id,content:x}),f.value=!1},O=()=>{ee.confirm({title:`確定要刪除「${n.todo.content}] ?`,icon:p(te),content:"刪掉的內容就像十年前的體重，再也回不去了",onOk(){return d("onDelete",{id:n.todo.id})}})};return(x,P)=>{const S=_("a-input"),E=_("a-tooltip");return o(),m("div",{class:Z(`listItem ${t.todo.status&&"finished"}`)},[h("label",{class:"toggleButton",onClick:I},[h("input",{type:"checkbox",value:t.todo.status},null,8,ve),t.todo.status?(o(),g(L(W),{key:0})):(o(),g(L($),{key:1}))]),f.value||t.loading?(o(),g(S,{key:0,disabled:t.loading,value:e.value,"onUpdate:value":P[0]||(P[0]=w=>e.value=w),onPressEnter:T},null,8,["disabled","value"])):(o(),m("p",{key:1,onDblclick:u},[p(E,null,{title:v(()=>[C("雙擊滑鼠兩下可修改內容")]),default:v(()=>[C(" "+U(t.todo.content),1)]),_:1})],32)),h("div",pe,[p(L(X),{style:{"font-size":"20px"},onClick:O})])],2)}}},V=R(fe,[["__scopeId","data-v-42243e8e"]]),_e=t=>(le("data-v-b510fddd"),t=t(),re(),t),ge={key:0},me={class:"body"},ye={key:0,class:"loading"},he={key:1},Te=_e(()=>h("br",null,null,-1)),be={key:1,class:"list"},ke={__name:"MyTodosView",setup(t){const l={ALL:"all",INCOMPLETE:"incomplete",COMPLETED:"completed"},n=oe(),d=y(!0),f=y(l.ALL),e=y(!1),I=y(),u=y([]),T=y(""),O=()=>{n.push({path:"/login"})};async function x(){e.value=!0;try{await k.addTodo({content:T.value});const a=await k.getTodos();u.value=a.data.data,T.value=""}catch(a){b.error({content:a.response.data.message,duration:2})}e.value=!1}const P=()=>{if(!e.value){if(T.value.trim().length===0){b.error({content:"內容不可為空",duration:3});return}x()}};async function S(){try{await A.signOut(),document.cookie=`${de}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; SameSite=None; Secure`,O()}catch{}}async function E({id:a}){if(!e.value){e.value=!0;try{await k.deleteTodo(a);const r=u.value.findIndex(i=>i.id===a);u.value.splice(r,1)}catch(r){b.error({content:r.response.data.message,duration:2})}e.value=!1}}async function w({id:a,status:r}){if(!e.value){e.value=!0;try{await k.toggleTodo(a);const i=u.value.findIndex(c=>c.id===a);u.value[i].status=r}catch(i){b.error({content:i.response.data.message,duration:2})}e.value=!1}}async function B({id:a,content:r}){if(!e.value){e.value=!0;try{await k.editTodo({id:a,content:r});const i=u.value.findIndex(c=>c.id===a);u.value[i].content=r}catch(i){b.error({content:i.response.data.message,duration:2})}e.value=!1}}const F=ne(()=>u.value.reduce((a,r)=>r.status?a:a+=1,0));return ae(()=>{async function a(){try{const c=await k.getTodos();u.value=c.data.data}catch(c){b.error({content:c.response.data.message,duration:2})}d.value=!1}async function r(){try{const c=await A.checkout();I.value=c.data,await a()}catch{O()}}ue()?r():O()}),(a,r)=>{const i=_("a-typography-title"),c=_("a-typography-text"),j=_("a-button"),H=_("a-flex"),Y=_("a-skeleton"),J=_("a-input-search"),q=_("a-alert"),D=_("a-tab-pane"),G=_("a-tabs");return o(),m("main",null,[h("nav",null,[p(H,{justify:"space-between"},{default:v(()=>[p(i,{level:3},{default:v(()=>[C("My Todos")]),_:1}),d.value?z("",!0):(o(),m("div",ge,[p(c,{strong:""},{default:v(()=>{var s;return[C(U((s=I.value)==null?void 0:s.nickname)+"的代辦",1)]}),_:1}),p(j,{type:"text",onClick:S},{default:v(()=>[C("登出")]),_:1})]))]),_:1})]),h("div",me,[d.value?(o(),m("div",ye,[p(Y,{active:""})])):(o(),m("div",he,[h("div",null,[p(J,{value:T.value,"onUpdate:value":r[0]||(r[0]=s=>T.value=s),placeholder:"新增待辦事項",size:"large",disabled:e.value,onSearch:P},{enterButton:v(()=>[p(j,{loading:e.value},{default:v(()=>[e.value?z("",!0):(o(),g(L(se),{key:0}))]),_:1},8,["loading"])]),_:1},8,["value","disabled"])]),Te,u.value.length===0?(o(),g(q,{key:0,message:"目前尚無待辦事項",type:"info","show-icon":""})):(o(),m("div",be,[p(G,{activeKey:f.value,"onUpdate:activeKey":r[1]||(r[1]=s=>f.value=s),type:"card"},{default:v(()=>[(o(),g(D,{key:l.ALL,tab:"全部"},{default:v(()=>[(o(!0),m(M,null,N(u.value,s=>(o(),g(V,{key:s.id,todo:s,loading:e.value,onOnToggle:w,onOnPressEnter:B,onOnDelete:E},null,8,["todo","loading"]))),128)),h("p",null,"未完成項目："+U(F.value),1)]),_:1})),(o(),g(D,{key:l.INCOMPLETE,tab:"未完成"},{default:v(()=>[(o(!0),m(M,null,N(u.value.filter(s=>!s.status),s=>(o(),g(V,{key:s.id,todo:s,loading:e.value,onOnToggle:w,onOnPressEnter:B,onOnDelete:E},null,8,["todo","loading"]))),128))]),_:1})),(o(),g(D,{key:l.COMPLETED,tab:"已完成"},{default:v(()=>[(o(!0),m(M,null,N(u.value.filter(s=>s.status),s=>(o(),g(V,{key:s.id,todo:s,loading:e.value,onOnToggle:w,onOnPressEnter:B,onOnDelete:E},null,8,["todo","loading"]))),128))]),_:1}))]),_:1},8,["activeKey"])]))]))])])}}},we=R(ke,[["__scopeId","data-v-b510fddd"]]);export{we as default};
