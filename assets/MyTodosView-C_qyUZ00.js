import{a as f,I as Q,_ as F,r as h,d as m,o as t,c as y,b as T,e as p,u as I,y as W,w as v,f as x,t as $,C as X,n as Z,M as ee,E as te,x as oe,l as ae,h as ne,g as D,P as se,F as N,j as V,p as le,k as ue}from"./index-CPtHe2_p.js";import{g as re,U as K,C as ce}from"./users.service-Cdh67N8Q.js";import{T as b}from"./todo.service-CvQajZR0.js";var ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"border",theme:"outlined"};function R(o){for(var l=1;l<arguments.length;l++){var a=arguments[l]!=null?Object(arguments[l]):{},c=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(a).filter(function(g){return Object.getOwnPropertyDescriptor(a,g).enumerable}))),c.forEach(function(g){de(o,g,a[g])})}return o}function de(o,l,a){return l in o?Object.defineProperty(o,l,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[l]=a,o}var j=function(l,a){var c=R({},l,a.attrs);return f(Q,R({},c,{icon:ie}),null)};j.displayName="BorderOutlined";j.inheritAttrs=!1;const ve=["value"],pe={class:"deleteButton"},fe={__name:"ListItem",props:["todo","loading"],emits:["onToggle","onPressEnter","onDelete"],setup(o,{emit:l}){const a=o,c=l,g=h(!1),e=h(a.todo.content),E=()=>{c("onToggle",{id:a.todo.id,status:!a.todo.status})},r=()=>{g.value=!0},k=()=>{const O=e.value.trim();e.value.trim().length!==0&&a.todo.content!==O&&c("onPressEnter",{id:a.todo.id,content:O}),g.value=!1},_=()=>{ee.confirm({title:`確定要刪除「${a.todo.content}] ?`,icon:f(te),content:"刪掉的內容就像十年前的體重，再也回不去了",onOk(){return c("onDelete",{id:a.todo.id})}})};return(O,C)=>{const P=m("a-input"),L=m("a-tooltip");return t(),y("div",{class:Z(`listItem ${o.todo.status&&"finished"}`)},[T("label",{class:"toggleButton",onClick:E},[T("input",{type:"checkbox",value:o.todo.status},null,8,ve),o.todo.status?(t(),p(I(W),{key:0})):(t(),p(I(j),{key:1}))]),g.value||o.loading?(t(),p(P,{key:0,disabled:o.loading,value:e.value,"onUpdate:value":C[0]||(C[0]=w=>e.value=w),onPressEnter:k},null,8,["disabled","value"])):(t(),y("p",{key:1,onDblclick:r},[f(L,null,{title:v(()=>[x("雙擊滑鼠兩下可修改內容")]),default:v(()=>[x(" "+$(o.todo.content),1)]),_:1})],32)),T("div",pe,[f(I(X),{style:{"font-size":"20px"},onClick:_})])],2)}}},U=F(fe,[["__scopeId","data-v-42243e8e"]]),ge=o=>(le("data-v-af1236cc"),o=o(),ue(),o),_e={key:0},me={class:"body"},ye={key:0,class:"loading"},he={key:1},Te=ge(()=>T("br",null,null,-1)),ke={key:1,class:"list"},Oe={__name:"MyTodosView",setup(o){const l={ALL:"all",INCOMPLETE:"incomplete",COMPLETED:"completed"},a=oe(),c=h(!0),g=h(l.ALL),e=h(!1),E=h(),r=h([]),k=h(""),_=h(""),O=()=>{a.push({path:"/login"})};async function C(){e.value=!0;try{await b.addTodo({content:k.value});const n=await b.getTodos();r.value=n.data.data,k.value=""}catch(n){_.value=n.response.data.message}e.value=!1}const P=()=>{if(!e.value){if(k.value.trim().length===0){_.value="內容不可為空";return}_.value="",C()}};async function L(){try{await K.signOut(),document.cookie=`${ce}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; SameSite=None; Secure`,O()}catch{}}async function w({id:n}){if(!e.value){e.value=!0;try{await b.deleteTodo(n);const u=r.value.findIndex(i=>i.id===n);r.value.splice(u,1)}catch(u){_.value=u.response.data.message}e.value=!1}}async function S({id:n,status:u}){if(!e.value){e.value=!0;try{await b.toggleTodo(n);const i=r.value.findIndex(d=>d.id===n);r.value[i].status=u}catch(i){_.value=i.response.data.message}e.value=!1}}async function B({id:n,content:u}){if(!e.value){e.value=!0;try{await b.editTodo({id:n,content:u});const i=r.value.findIndex(d=>d.id===n);r.value[i].content=u}catch(i){_.value=i.response.data.message}e.value=!1}}const H=ae(()=>r.value.reduce((n,u)=>u.status?n:n+=1,0));return ne(()=>{async function n(){try{const d=await b.getTodos();r.value=d.data.data,c.value=!1}catch(d){_.value=d.response.data.message}}async function u(){try{const d=await K.checkout();E.value=d.data,await n()}catch{O()}}re()?u():O()}),(n,u)=>{const i=m("a-typography-title"),d=m("a-typography-text"),A=m("a-button"),Y=m("a-flex"),J=m("a-skeleton"),z=m("a-alert"),q=m("a-input-search"),M=m("a-tab-pane"),G=m("a-tabs");return t(),y("main",null,[T("nav",null,[f(Y,{justify:"space-between"},{default:v(()=>[f(i,{level:3},{default:v(()=>[x("My Todos")]),_:1}),c.value?D("",!0):(t(),y("div",_e,[f(d,{strong:""},{default:v(()=>{var s;return[x($((s=E.value)==null?void 0:s.nickname)+"的代辦",1)]}),_:1}),f(A,{type:"text",onClick:L},{default:v(()=>[x("登出")]),_:1})]))]),_:1})]),T("div",me,[c.value?(t(),y("div",ye,[f(J,{active:""})])):(t(),y("div",he,[T("div",null,[_.value?(t(),p(z,{key:0,message:_.value,type:"error","show-icon":""},null,8,["message"])):D("",!0),f(q,{value:k.value,"onUpdate:value":u[0]||(u[0]=s=>k.value=s),placeholder:"新增待辦事項",size:"large",disabled:e.value,onSearch:P},{enterButton:v(()=>[f(A,{loading:e.value},{default:v(()=>[e.value?D("",!0):(t(),p(I(se),{key:0}))]),_:1},8,["loading"])]),_:1},8,["value","disabled"])]),Te,r.value.length===0?(t(),p(z,{key:0,message:"目前尚無待辦事項",type:"info","show-icon":""})):(t(),y("div",ke,[f(G,{activeKey:g.value,"onUpdate:activeKey":u[1]||(u[1]=s=>g.value=s),type:"card"},{default:v(()=>[(t(),p(M,{key:l.ALL,tab:"全部"},{default:v(()=>[(t(!0),y(N,null,V(r.value,s=>(t(),p(U,{key:s.id,todo:s,loading:e.value,onOnToggle:S,onOnPressEnter:B,onOnDelete:w},null,8,["todo","loading"]))),128)),T("p",null,"未完成項目："+$(H.value),1)]),_:1})),(t(),p(M,{key:l.INCOMPLETE,tab:"未完成"},{default:v(()=>[(t(!0),y(N,null,V(r.value.filter(s=>!s.status),s=>(t(),p(U,{key:s.id,todo:s,loading:e.value,onOnToggle:S,onOnPressEnter:B,onOnDelete:w},null,8,["todo","loading"]))),128))]),_:1})),(t(),p(M,{key:l.COMPLETED,tab:"已完成"},{default:v(()=>[(t(!0),y(N,null,V(r.value.filter(s=>s.status),s=>(t(),p(U,{key:s.id,todo:s,loading:e.value,onOnToggle:S,onOnPressEnter:B,onOnDelete:w},null,8,["todo","loading"]))),128))]),_:1}))]),_:1},8,["activeKey"])]))]))])])}}},Ee=F(Oe,[["__scopeId","data-v-af1236cc"]]);export{Ee as default};
